---
title: "Emerald Pickups Analysis"
author: "David"
date: "2026-02-19"
output: html_document
---

## Setup

```{r setup}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(readxl)
library(dplyr)
library(lubridate)
library(janitor)
library(tidyr)
library(ggplot2)
library(scales)
```

## 1) Read pickups data

```{r read-pickups}
df_raw <- read_excel(
  "Meters Data 2024.xlsx",
  sheet = "Emerald Pickups",
  range = "A1:P50074"
) %>%
  clean_names()
```



```{r}
pickup_pa <-df_raw %>% 
  filter(state== "PA")
  
```






## 5) Read meter features and keep one row per customer

```{r read-meters}
meters <- read_excel(
  "Meters Data 2024.xlsx",
  sheet = "Combined Meter Data"
) %>%
  clean_names()
pa_meters <- meters %>%
  filter(state == "PA")

```





```{r}
library(readxl)
library(dplyr)

data <- read_excel("Service_Territory_2024.xlsx")

colnames(data)

pa_data <- data %>%
  filter(State == "PA")

pa_data <- pa_data %>% 
  clean_names()
```


```{r}
df_pa_2 <- pa_data %>%
  right_join(pa_meters, by = c("utility_number"), relationship = "many-to-one")

df_pa_2 <- pa_data %>%
  right_join(pa_meters, by = "utility_number", relationship = "many-to-one") %>%
  select(-ends_with(".y")) %>%
  rename_with(~ str_remove(., "\\.x$"))
```




```{r}
df_pa_full <- df_pa_2 %>%
 left_join(pickup_pa, by = c("emerald_customer_id" = "customer_id"), relationship = "many-to-many")

#Running this adds monthly pickup numbers for each emerald customer, howeversome customers will have multiple rows indicating seperate counties served but pickup per month sums across all counties/customers 
```